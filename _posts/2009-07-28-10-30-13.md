---
layout: post
title: Virtual Box 3 and Windows 7 (Making it work!)
---


<p><font size="3" face="Tahoma">On and off for the last few weeks I have been trying to get VirtualBox 3.0.2 installed on my Windows 7 RC device with no real success :(. During every install I ended up getting the dreaded “Setup wizard end prematurely” and subsequently VirtualBox wouldn't get installed and it would be back to the drawing board.</font></p>  <p><font size="3" face="Tahoma">Well, after some troubleshooting and some customizing of the MSI file I have finally got VirtualBox installed and running :) but wanted to put this post together for those that are running into the same issue.</font></p>  <p><font size="3" face="Tahoma"></font></p>  <p><font size="3" face="Tahoma">So, let’s get to it :)</font></p>  <p><font size="3" face="Tahoma">First, let me define what my system is     <br />1) Windows 7 Ultimate RC 64bit.      <br />2) No previous version of Virtual Box installed on this device.</font></p>  <p><font size="3" face="Tahoma">What your going to need:     <br />1) Orca MSI Editor      <br />2) Windows Driver Kit (MSDN Downloads)</font></p>  <p><font size="3" face="Tahoma">Running the downloaded install of VirtualBox you will get the following installation error. The dreaded “Setup wizard ended prematurely”! That’s never good!</font></p>  <p><a href="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image.png"><font size="3" face="Tahoma"><a href="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image1.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image-thumb.png" width="514" height="403" /></a></font></a><font size="3" face="Tahoma"> </font></p>  <p><font size="3"><font face="Tahoma">After looking at the log file, you will notice a curious error       <br /><strong><font color="#800040">”DIFXAPP: ERROR - The operating system you are running on is not supported. Only Windows 2000, Windows XP, Windows Server 2003 and Windows “</font></strong></font></font></p>  <p><font color="#000000" size="3" face="Tahoma">After, looking at the above message it appears that DIFXAPP is having a problem some where, my first theory is that the VirtualBox installer is using an older version of the DIFXAPP dll.      <br />So, armed with the above theory, lets update the MSI installer with the updated versions of DIFXAPP dlls.</font></p>  <p><font color="#000000"><font size="3" face="Tahoma">The first thing we need to do, is to download the Windows Driver Kit (Specifically I downloaded the driver kit for Windows 7). This download contains the updated DIFXAPP file that we are going to need to replace the ones in the MSI. Right now it looks like this download is on the MSDN Subscribers site so you will probably need a MSDN Subscription in order to download it. You can access the site </font><a href="http://msdn.microoft.com/subscriptions" target="_blank"><font size="3" face="Tahoma">here</font></a><font size="3" face="Tahoma">.</font></font></p>  <p><font size="3" face="Tahoma">After you have downloaded and installed the Windows Driver Kit we are going to need to update the MSI with these new updated files. I know what your thinking, We didn't get an MSI when we downloaded, we got an EXE. No problem, let me explain. When we run the virtualbox insaller, the EXE extracts and MSI called VirtualBox-3.0.2-r49928-MultiArch_amd64.msi, as see in the following image. </font></p>  <p><font size="3" face="Tahoma">Now, where exactly is this file? The MSI file will get extracted to the users temp appdata folder. On Windows 7 it will be located in the following location      <br />C:Users[YourUsername]AppDataLocalTempVirtualBox</font></p>  <p><a href="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image2.png"><font size="3" face="Tahoma"><a href="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image3.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image-thumb1.png" width="683" height="40" /></a></font></a><font size="3" face="Tahoma"> </font></p>  <p><font size="3" face="Tahoma"></font></p>  <p><font size="3" face="Tahoma">So, now that we have all the necessary files, we need to put it all together and update the MSI file with the updated DIFXAPP dlls. The first thing we are going to want to do is to open up the above MSI file in the Microsoft ORCA MSI Editor. Once you do you will see the following. Note the Binary item in the left pane in selected and in the right pane you can see the DIFX*.dll files that we are going to need to replace.</font></p>  <p><a href="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image4.png"><font size="3" face="Tahoma"><a href="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image5.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image-thumb2.png" width="596" height="520" /></a></font></a><font size="3" face="Tahoma"> </font></p>  <p><font size="3" face="Tahoma">The next thing we need to do is to delete the DIFX*.dll items from the MSI. You can do this by right clicking on the DIFxApp.dll and selecting “Drop Row” from the menu that pops up. You will need to do this for the DIFxAppA.dll as well. Like the following</font></p>  <p><a href="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image6.png"><font size="3" face="Tahoma"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image-thumb3.png" width="603" height="621" /></font></a><font size="3" face="Tahoma"> </font></p>  <p><a href="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image7.png"><font size="3" face="Tahoma"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image-thumb4.png" width="549" height="525" /></font></a><font size="3" face="Tahoma"> </font></p>  <p><font size="3" face="Tahoma"></font></p>  <p><font size="3" face="Tahoma">The next thing is is to re-add the updated DIFX files we got from the updated Windows Driver Kit to the MSI file. We can do this by right clicking and selecting “Add Row”</font></p>  <p><a href="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image8.png"><font size="3" face="Tahoma"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image-thumb5.png" width="512" height="656" /></font></a><font size="3" face="Tahoma"> </font></p>  <p><font size="3" face="Tahoma"></font></p>  <p><font size="3" face="Tahoma">Now we need to select the updated DIFxApp.dll we extracted from the Windows Driver Kit we downloaded earlier. In my installation it is located here     <br />C:WinDDK7100.0.0redistDIFxDIFxAppWixLibamd64 </font></p>  <p><font size="3" face="Tahoma">Make sure the Name Attribute is the exact name as the DLL name. For example, the name for the DIFxApp.dll you be DIFxApp.dll</font></p>  <p><font size="3" face="Tahoma">You will need to do this once for the DIFxApp.dll and once for the DIFxAppA.dll files. Like the following screen shots.</font></p>  <p><a href="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image9.png"><font size="3" face="Tahoma"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image-thumb6.png" width="654" height="578" /></font></a><font size="3" face="Tahoma"> </font></p>  <p><a
 href="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image10.png"><font size="3" face="Tahoma"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://www.sharepoint-stuff.com/wp-content/uploads/2009/07/image-thumb7.png" width="734" height="612" /></font></a><font size="3" face="Tahoma"> </font></p>  <p><font size="3" face="Tahoma"></font></p>  <p><font size="3" face="Tahoma">Once that is complete, you will need to save the MSI file from ORCA. Make sure you just do a File-&gt;Save. If you do a SaveAs the MSI will lose information and it will not work.</font></p>  <p><font size="3" face="Tahoma">Once you complete the save you will now be able to run the MSI and get VirtualBox installed.</font></p>  <p><font size="3" face="Tahoma">I am working on a quick video to show the results and should have it up soon. If you have any questions/comments feel free to comment and ping my on twitter twitter.com/johnmcbride</font></p>  <p><font size="3" face="Tahoma"></font></p>  <p><font size="3" face="Tahoma"></font></p>  <p><font size="3" face="Tahoma"></font></p>  <p><font size="3" face="Tahoma"></font></p>  <p><font size="3" face="Tahoma"></font></p>  <p><font size="3" face="Tahoma"></font></p>
